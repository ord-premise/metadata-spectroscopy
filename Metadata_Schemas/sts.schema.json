{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://example.com/sts.schema.json",
    "title": "STS",
    "description": "An STS",
    "type": "object",
    "properties": {
        "name": {
            "type": "string",
            "description": "The name of the STS."
        },
        "recordingTime": {
            "type": "string",
            "description": "The date of the STS.",
            "format": "date-time"
        },
        "duration": {
            "type": "object",
            "description": "The duration of the STS.",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "experimentType": {
            "type": "string",
            "description": "Experiment type",
            "enum": ["Bias spectroscopy", "Z-spectroscopy"]
        },
        "acquisitionCoordinates": {
            "type": "object",
            "description": "Acquisition coordinates",
            "properties": {
                "x": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "y": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "z": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "feedbackActive": {
            "type": "string",
            "description": "Whether feedback is active",
            "enum": ["active", "inactive"]
        },
        "finalZ": {
            "type": "object",
            "description": "Final Z",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "filterType": {
            "type": "string",
            "description": "Filter type",
            "enum": ["Butterworth"]
        },
        "filterOrder": {
            "type": "integer",
            "description": "Filter order",
            "minimum": 1
        },
        "filterCutoff": {
            "type": "object",
            "description": "Filter Cutoff",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "biasSettings": {
            "type": "object",
            "description": "Bias voltage settings.",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibrationFactor": {
                    "type": "object",
                    "description": "Calibration factor",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibrationOffset": {
                    "type": "object",
                    "description": "Calibration offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "numPixel": {
            "type": "integer",
            "description": "Number of recorded points"
        },
        "ZAvgTime": {
            "type": "object",
            "description": "Duration over which the Z position is recorded and averaged before and after the sweep",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "firstSettlingTime": {
            "type": "object",
            "description": "Additional time to wait (in addition to the Settling Time) after the bias has ramped to the starting point of the sweep",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "settlingTime": {
            "type": "object",
            "description": "Time to wait after changing the bias to the next level and before starting to acquire data",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "integrationTime": {
            "type": "object",
            "description": "Time during which the data are acquired and averaged",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "endSettlingTime": {
            "type": "object",
            "description": "Time to wait after the sweep has finished and the bias is ramped to the initial value",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "ZControlTime": {
            "type": "object",
            "description": "Time during which the Z-controller is enabled once a sweep has finished",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "maxSlewRate": {
            "type": "object",
            "description": "Max rate at which the bias changes (before, during and after sweeping)",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "backwardSweep": {
            "type": "boolean",
            "description": "Whether one wants to measure the backward (return) sweep or the forward only"
        },
        "numSweeps": {
            "type": "integer",
            "description": "Number of sweeps to measure and average"
        },
        "channelNames": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "Recorded channel names"
        },
        "recordFinalZ": {
            "type": "boolean",
            "description": "Record the Z position during Z averaging time at the end of the sweep (after Z control time)"
        },
        "lockInRun": {
            "type": "integer",
            "description": "Lock-in to run during the measurement"
        },
        "biasSpectroscopySettings": {
            "type": "object",
            "description": "Bias spectroscopy settings.",
            "properties": {
                "resetBias": {
                    "type": "boolean",
                    "description": "Reset bias to the initial value (before starting the sweep) at the end of the spectroscopy measurement."
                },
                "sweepStart": {
                    "type": "object",
                    "description": "Sweep start",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "sweepEnd": {
                    "type": "object",
                    "description": "Sweep end",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "ZOffset": {
                    "type": "object",
                    "description": "Z offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "ZControllerHold": {
                    "type": "boolean",
                    "description": "If Z-controller is being used."
                }
            }
        },
        "ZSpectroscopySettings": {
            "type": "object",
            "description": "Z-spectroscopy settings.",
            "properties": {
                "resetZ": {
                    "type": "boolean",
                    "description": "Reset the Z position at the end of the sweep to the initial averaged value calculated during Z averaging time at Max slew rate."
                },
                "initialZOffset": {
                    "type": "object",
                    "description": "Initial Z offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "sweepDistance": {
                    "type": "object",
                    "description": "Sweep distance",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "timeBetweenForwardBackward": {
                    "type": "object",
                    "description": "Time to wait in seconds between the forward and the backward sweep.",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "currentSettings": {
            "type": "object",
            "description": "Current settings.",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibrationFactor": {
                    "type": "object",
                    "description": "Calibration factor",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibrationOffset": {
                    "type": "object",
                    "description": "Calibration offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "gain": {
                    "type": "number",
                    "description": "Gain"
                }
            }
        },
        "Z": {
            "type": "object",
            "description": "Tip position in Z axis",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "feedbackSettings": {
            "type": "object",
            "description": "Feedback settings.",
            "properties": {
                "feedbackActive": {
                    "type": "string",
                    "description": "Whether feedback is active",
                    "enum": ["active", "inactive"]
                },
                "feedbackType": {
                    "type": "string",
                    "description": "Feedback type",
                    "enum": ["Log current", "Abs current"]
                }
            }
        },
        "ZControllerSettings": {
            "type": "object",
            "description": "Z-Controller settings.",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "pGain": {
                    "type": "number",
                    "description": "Proportional gain"
                },
                "iGain": {
                    "type": "number",
                    "description": "Integral gain"
                },
                "timeConstant": {
                    "type": "object",
                    "description": "Time constant",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "tipLift": {
                    "type": "object",
                    "description": "Position of the tip when feedback loop is off",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "switchOffDelay": {
                    "type": "object",
                    "description": "Time delay applied when switching off feedback loop",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        // Fiquei no lock in
        "lockInSettings": {
            "type": "object",
            "description": "Piezo configuration settings.",
            "properties": {
                "status": {
                    "type": "boolean",
                    "description": "If lock-in is on or not."
                },
                "modulatedSignal": {
                    "type": "string",
                    "description": "Signal on which the modulation (sine) will be added"
                },
                "frequency": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "amplitude": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "demodulatedSignal": {
                    "type": "string",
                    "description": "Signal which will be demodulated",
                    "enum": ["Current"]
                },
                "hpFilterCutoffs": {
                    "type": "array",
                    "description": "Cutoff frequency of the high-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": "number"
                            },
                            "unit": {
                                "type": "string"
                            }
                        }
                    }
                },
                "hpFilterOrders": {
                    "type": "array",
                    "description": "Cutoff frequency of the high-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "harmonics": {
                    "type": "array",
                    "description": "Order of the harmonic oscillation to detect on the demodulated signal",
                    "items": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "referencePhases": {
                    "type": "array",
                    "description": "Reference phase for the sine on the demodulated signal with respect to the modulation signal",
                    "items": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": "number"
                            },
                            "unit": {
                                "type": "string"
                            }
                        }
                    }
                },
                "lpFilterCutoffs": {
                    "type": "array",
                    "description": "Cutoff frequency of the low-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": "number"
                            },
                            "unit": {
                                "type": "string"
                            }
                        }
                    }
                },
                "lpFilterOrders": {
                    "type": "array",
                    "description": "Cutoff frequency of the low-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "syncFilter": {
                    "type": "boolean",
                    "description": "If use sync filter (Operates after the low-pass filter and averages the demodulated signals over one period of the modulation frequency"
                }
            }
        },
        "sampleTemperature": {
            "type": "Sample temperature",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "comments": {
            "type": "string",
            "description": "Comments to the STM."
        },
        "annealing": {
            "$ref": "./annealing.schema.json",
            "description": "Details about the annealing before the STS"
        },
        "deposition": {
            "$ref": "./deposition.schema.json",
            "description": "Details about the deposition before the STS"
        },
        "required": ["name", "recordingTime", "duration", "biasSettings", "currentSettings", "Z"]
    }
}